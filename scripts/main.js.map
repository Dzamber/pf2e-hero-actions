{"mappings":"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","sources":["src/main.ts","../../../../Projects/foundry-ts/utils/foundry/module.ts","src/module.ts","../../../../Projects/foundry-ts/utils/foundry/settings.ts","../../../../Projects/foundry-ts/utils/foundry/path.ts","../../../../Projects/foundry-ts/utils/handlebars.ts","../../../../Projects/foundry-ts/utils/string.ts","../../../../Projects/foundry-ts/utils/socket.ts","src/api.ts","../../../../Projects/foundry-ts/utils/foundry/flags.ts","../../../../Projects/foundry-ts/utils/foundry/i18n.ts","../../../../Projects/foundry-ts/utils/foundry/notifications.ts","src/actions.ts","../../../../Projects/foundry-ts/utils/foundry/uuid.ts","src/sheet.ts","src/apps/trade.ts","../../../../Projects/foundry-ts/utils/foundry/actor.ts","../../../../Projects/foundry-ts/utils/foundry/user.ts","src/trade.ts"],"sourcesContent":["import { getCurrentModule } from './@utils/foundry/module'\r\nimport { registerSetting } from './@utils/foundry/settings'\r\nimport { registerLocalizeHelper } from './@utils/handlebars'\r\nimport { socketOn } from './@utils/socket'\r\nimport { createTable, removeHeroActions } from './api'\r\nimport { refreshSheets, renderCharacterSheetPF2e } from './sheet'\r\nimport { onTradeAccepted, onTradeError, onTradeRejected, onTradeRequest } from './trade'\r\n\r\nHooks.once('init', () => {\r\n    registerLocalizeHelper()\r\n\r\n    registerSetting({\r\n        name: 'tableUUID',\r\n        type: String,\r\n        default: '',\r\n        config: true,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'trade',\r\n        type: Boolean,\r\n        default: false,\r\n        config: true,\r\n        onChange: refreshSheets,\r\n    })\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    socketOn(onPacketReceived)\r\n\r\n    if (!game.user.isGM) return\r\n\r\n    getCurrentModule().api = {\r\n        createTable: createTable,\r\n        removeHeroActions: removeHeroActions,\r\n    }\r\n})\r\n\r\nHooks.on('renderCharacterSheetPF2e', renderCharacterSheetPF2e)\r\n\r\nexport function onPacketReceived(packet: Packet) {\r\n    switch (packet.type) {\r\n        case 'trade-reject':\r\n            if (packet.sender.id !== game.user.id) return\r\n            onTradeRejected(packet)\r\n            break\r\n        case 'trade-accept':\r\n            if (!game.user.isGM) return\r\n            onTradeAccepted(packet)\r\n            break\r\n        case 'trade-request':\r\n            if (packet.receiver.id !== game.user.id) return\r\n            onTradeRequest(packet)\r\n            break\r\n        case 'trade-error':\r\n            if (!packet.users.includes(game.user.id)) return\r\n            onTradeError(packet.error)\r\n            break\r\n    }\r\n}\r\n","import MODULE_ID from '~./src/module'\r\n\r\ntype OwnModule = 'anonymous' | 'idleuh'\r\n\r\ntype ReturnedModule<T extends Record<string, any> = Record<string, any>> = Module<T> | undefined\r\ntype ReturnedModuleApi<T extends Record<string, any> = Record<string, any>> = Module<T>['api'] | undefined\r\n\r\nexport function getModule(id: 'anonymous'): ReturnedModule<AnonymousApi>\r\nexport function getModule(id: 'idleuh'): ReturnedModule<IdleuhApi>\r\nexport function getModule(id: 'pf2e-hero-actions'): ReturnedModule<HeroActionsApi>\r\nexport function getModule(id: string): ReturnedModule\r\nexport function getModule(id: string | OwnModule) {\r\n    return game.modules.get(id)\r\n}\r\n\r\nexport function getCurrentModule() {\r\n    return getModule(MODULE_ID)!\r\n}\r\n\r\nexport function getModuleApi(id: 'anonymous'): ReturnedModuleApi<AnonymousApi>\r\nexport function getModuleApi(id: 'idleuh'): ReturnedModuleApi<IdleuhApi>\r\nexport function getModuleApi(id: 'pf2e-hero-actions'): ReturnedModuleApi<HeroActionsApi>\r\nexport function getModuleApi(id: string): ReturnedModuleApi\r\nexport function getModuleApi(id: string | OwnModule) {\r\n    return getModule(id)?.api\r\n}\r\n","export default 'pf2e-hero-actions'\r\n","import MODULE_ID from '~./src/module'\r\nimport { getSettingLocalizationPath } from './path'\r\n\r\nexport function getSetting<T extends any>(key: string) {\r\n    return game.settings.get(MODULE_ID, key) as T\r\n}\r\n\r\nexport function setSetting(key: string, value: unknown) {\r\n    return game.settings.set(MODULE_ID, key, value)\r\n}\r\n\r\n/**\r\n * options.scope = 'world'\r\n *\r\n * options.config = false\r\n */\r\nexport function registerSetting(options: SettingRegistration) {\r\n    const name = options.name\r\n    options.scope = options.scope ?? 'world'\r\n    options.config = options.config ?? false\r\n    if (options.config) {\r\n        options.name = getSettingLocalizationPath(name, 'name')\r\n        options.hint = getSettingLocalizationPath(name, 'hint')\r\n    }\r\n    game.settings.register(MODULE_ID, name, options)\r\n}\r\n\r\n/**\r\n * options.restricted = true\r\n *\r\n * options.icon = 'fas fa-cogs'\r\n */\r\nexport function registerSettingMenu(\r\n    options: RequiredBy<Partial<Omit<SettingSubmenuConfig, 'type'>>, 'name'> & { type: ConstructorOf<FormApplication> }\r\n) {\r\n    const name = options.name\r\n    options.name = getSettingLocalizationPath('menus', name, 'name')\r\n    options.label = getSettingLocalizationPath('menus', name, 'label')\r\n    options.hint = getSettingLocalizationPath('menus', name, 'hint')\r\n    options.restricted = options.restricted ?? true\r\n    options.icon = options.icon ?? 'fas fa-cogs'\r\n    game.settings.registerMenu(MODULE_ID, name, options as SettingSubmenuConfig)\r\n}\r\n","import MODULE_ID from '~./src/module'\r\n\r\nexport function getSettingLocalizationPath(...path: string[]) {\r\n    return `${MODULE_ID}.settings.${path.join('.')}`\r\n}\r\n\r\nexport function flagsUpdatePath(...path: string[]) {\r\n    return `flags.${MODULE_ID}.${path.join('/')}`\r\n}\r\n\r\nexport function templatePath(...path: string[]) {\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n","import MODULE_ID from '~./src/module'\r\nimport { camelCase } from './string'\r\n\r\nexport function registerHelper(name: string, fn: Handlebars.HelperDelegate) {\r\n    if (Handlebars.helpers[name]) return\r\n    Handlebars.registerHelper(name, fn)\r\n}\r\n\r\nexport function registerLocalizeHelper() {\r\n    const name = camelCase(MODULE_ID)\r\n    registerHelper(name, function (key, options) {\r\n        key = `${MODULE_ID}.templates.${key}`\r\n        const data = options.hash\r\n        return isEmpty(data) ? game.i18n.localize(key) : game.i18n.format(key, data)\r\n    })\r\n}\r\n","const CAMEL_CASE_REGEX = /[_ -]+([a-zA-Z0-9])/g\r\nconst SNAKE_CASE_REGEX = / +/g\r\n\r\nexport function capitalize(str: string) {\r\n    if (!str) return ''\r\n    return str[0].toUpperCase() + str.slice(1)\r\n}\r\n\r\nexport function camelCase(str: string) {\r\n    return str.replace(CAMEL_CASE_REGEX, (_, c) => c.toUpperCase())\r\n}\r\n\r\nexport function snakeCase(str: string) {\r\n    return str.toLowerCase().replace(SNAKE_CASE_REGEX, '-')\r\n}\r\n","import MODULE_ID from '~./src/module'\r\n\r\nexport function socketOn<T extends SocketPacket = SocketPacket>(callback: SocketCallback<T>) {\r\n    game.socket.on(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketEmit<T extends SocketPacket = SocketPacket>(packet: T) {\r\n    game.socket.emit(`module.${MODULE_ID}`, packet)\r\n}\r\n","import { setFlag } from './@utils/foundry/flags'\r\nimport { subLocalize } from './@utils/foundry/i18n'\r\nimport { info, warn } from './@utils/foundry/notifications'\r\nimport { templatePath } from './@utils/foundry/path'\r\nimport { setSetting } from './@utils/foundry/settings'\r\nimport { createCustomActionsTable, createDefautActionsTable, getDefaultWorldTable, getTableSource } from './actions'\r\n\r\nexport const CREATE_TABLE_UUID = 'Compendium.pf2e-hero-actions.macros.SUXi4nhdJb8vZk58'\r\n\r\nconst localizeChoice = subLocalize('templates.createTable.choice')\r\nconst localizeDefaultConfirm = subLocalize('templates.createTable.default.confirm')\r\nconst localizeRemove = subLocalize('templates.removeActions')\r\n\r\nexport async function removeHeroActions() {\r\n    const template = templatePath('dialogs/remove-actions.html')\r\n\r\n    const buttons: Record<string, DialogButton> = {\r\n        yes: {\r\n            label: localizeRemove('remove'),\r\n            icon: '<i class=\"fas fa-trash\"></i>',\r\n            callback: html =>\r\n                html\r\n                    .find<HTMLInputElement>('input[name=\"actor\"]:checked')\r\n                    .toArray()\r\n                    .map(x => game.actors.get(x.value))\r\n                    .filter(x => x),\r\n        },\r\n        no: {\r\n            label: localizeRemove('cancel'),\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            callback: () => [],\r\n        },\r\n    }\r\n\r\n    const data: DialogData = {\r\n        content: await renderTemplate(template, { actors: game.actors.filter(x => x.type === 'character') }),\r\n        title: localizeRemove('title'),\r\n        buttons,\r\n        default: 'yes',\r\n        render: html => {\r\n            html.on('change', 'input[name=\"all\"]', () => removeActionsToggleAll(html))\r\n            html.on('change', 'input[name=\"actor\"]', () => removeActionsToggleActor(html))\r\n        },\r\n        close: () => [],\r\n    }\r\n\r\n    const actors = await Dialog.wait(data, undefined, { id: 'pf2e-hero-actions-remove-actions' })\r\n    if (!actors.length) {\r\n        return warn('templates.removeActions.noSelection')\r\n    }\r\n\r\n    for (const actor of actors) {\r\n        await setFlag(actor, 'heroActions', [])\r\n    }\r\n\r\n    info('templates.removeActions.removed')\r\n}\r\n\r\nfunction removeActionsToggleAll(html: JQuery) {\r\n    const state = html.find<HTMLInputElement>('input[name=\"all\"]')[0].checked\r\n    html.find('input[name=\"actor\"]').prop('checked', state)\r\n}\r\n\r\nfunction removeActionsToggleActor(html: JQuery) {\r\n    const actors = html.find('input[name=\"actor\"]')\r\n    const checked = actors.filter(':checked')\r\n    const all = html.find('input[name=\"all\"]')\r\n\r\n    if (actors.length === checked.length) {\r\n        all.prop('checked', true).prop('indeterminate', false)\r\n        actors.prop('checked', true)\r\n    } else if (!checked.length) {\r\n        all.prop('checked', false).prop('indeterminate', false)\r\n        actors.prop('checked', false)\r\n    } else {\r\n        all.prop('checked', false).prop('indeterminate', true)\r\n    }\r\n}\r\n\r\nexport async function createTable() {\r\n    const template = templatePath('dialogs/create-table.html')\r\n\r\n    const buttons: Record<string, DialogButton> = {\r\n        yes: {\r\n            label: localizeChoice('create'),\r\n            icon: '<i class=\"fas fa-border-all\"></i>',\r\n            callback: html => {\r\n                const type = html.find('.window-content input[name=\"type\"]:checked').val()\r\n                const unique = html.find('.window-content input[name=\"draw\"]:checked').val() === 'unique'\r\n                return { type, unique }\r\n            },\r\n        },\r\n        no: {\r\n            label: localizeChoice('cancel'),\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            callback: () => null,\r\n        },\r\n    }\r\n\r\n    /** @type {DialogData} */\r\n    const data = {\r\n        content: await renderTemplate(template),\r\n        title: localizeChoice('title'),\r\n        buttons,\r\n        default: 'yes',\r\n        close: () => null,\r\n    }\r\n\r\n    const result = await Dialog.wait(data, undefined, { id: 'pf2e-hero-actions-create-table' })\r\n    if (!result) return\r\n\r\n    if (result.type === 'default') createDefaultTable(result.unique)\r\n    else createCustomTable(result.unique)\r\n}\r\n\r\nasync function createDefaultTable(unique: boolean) {\r\n    let table = await getDefaultWorldTable()\r\n\r\n    if (table) {\r\n        const override = await Dialog.confirm({\r\n            title: localizeDefaultConfirm('title'),\r\n            content: localizeDefaultConfirm('content'),\r\n        })\r\n\r\n        if (override) {\r\n            const update = getTableSource(unique)\r\n            await table.update(update)\r\n            return setTable(table, true)\r\n        }\r\n    }\r\n\r\n    table = await createDefautActionsTable(unique)\r\n    await setTable(table)\r\n}\r\n\r\nasync function createCustomTable(unique: boolean) {\r\n    const table = await createCustomActionsTable(unique)\r\n    await setTable(table)\r\n    table.sheet?.render(true)\r\n}\r\n\r\nasync function setTable(table: RollTable, normalize = false) {\r\n    if (normalize) await table.normalize()\r\n    await setSetting('tableUUID', table.uuid)\r\n}\r\n","import MODULE_ID from '~./src/module'\r\n\r\nexport function hasModuleFlag(doc: foundry.abstract.Document) {\r\n    // @ts-ignore\r\n    return !!doc.flags && MODULE_ID in doc.flags\r\n}\r\n\r\nexport function getFlag<T extends unknown>(doc: foundry.abstract.Document, key: string, ...keys: string[]) {\r\n    keys.unshift(key)\r\n    return doc.getFlag(MODULE_ID, keys.join('.')) as T | undefined\r\n}\r\n\r\n/**\r\n * @template {foundry.Document} T\r\n * @param {T} doc\r\n * @param {string} key\r\n * @param {any} value\r\n * @returns T\r\n */\r\nexport function setFlag(doc: foundry.abstract.Document, key: string, value: unknown) {\r\n    return doc.setFlag(MODULE_ID, key, value)\r\n}\r\n","import MODULE_ID from '~./src/module'\r\n\r\nexport function localize(key: string, data?: Record<string, string | number>) {\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function subLocalize(subKey: string) {\r\n    return (key: string, data?: Record<string, string>) => localize(`${subKey}.${key}`, data)\r\n}\r\n","import { localize } from './i18n'\r\n\r\nexport function notify(\r\n    str: string,\r\n    arg1?: 'warning' | 'info' | 'error' | boolean | Record<string, string>,\r\n    arg2?: boolean | Record<string, string>,\r\n    arg3?: boolean\r\n) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(str: string, arg1?: boolean | Record<string, string>, arg2?: boolean) {\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(str: string, arg1?: boolean | Record<string, string>, arg2?: boolean) {\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(str: string, arg1?: boolean | Record<string, string>, arg2?: boolean) {\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n","import { getFlag, setFlag } from './@utils/foundry/flags'\r\nimport { localize } from './@utils/foundry/i18n'\r\nimport { error } from './@utils/foundry/notifications'\r\nimport { getSetting } from './@utils/foundry/settings'\r\nimport { documentUuidFromTableResult } from './@utils/foundry/uuid'\r\n\r\nconst DECK_PACK = 'pf2e.hero-point-deck' as const\r\nconst TABLE_PACK = 'pf2e.rollable-tables' as const\r\nconst TABLE_ID = 'zgZoI7h0XjjJrrNK' as const\r\nconst TABLE_UUID = `Compendium.${TABLE_PACK}.${TABLE_ID}` as const\r\nconst ICON = 'systems/pf2e/icons/features/feats/heroic-recovery.webp' as const\r\n\r\nasync function getTableFromUuid(uuid: string | undefined) {\r\n    if (!uuid) return undefined\r\n    const table = await fromUuid(uuid)\r\n    return table && table instanceof RollTable ? table : undefined\r\n}\r\n\r\nexport async function getDefaultCompendiumTable() {\r\n    return /** @type {Promise<RollTable>} */ getTableFromUuid(TABLE_UUID)\r\n}\r\n\r\nexport async function getDefaultWorldTable() {\r\n    return game.tables.find(x => x.getFlag('core', 'sourceId') === TABLE_UUID)\r\n}\r\n\r\nexport async function getCustomTable() {\r\n    return getTableFromUuid(getSetting('tableUUID'))\r\n}\r\n\r\nexport async function getDeckTable() {\r\n    return (await getCustomTable()) ?? (await getDefaultWorldTable()) ?? (await getDefaultCompendiumTable())\r\n}\r\n\r\nexport function getHeroActions(actor: CharacterPF2e): HeroAction[] {\r\n    const actions = getFlag<Array<HeroAction | string>>(actor, 'heroActions') ?? []\r\n    const pack = game.packs.get(DECK_PACK)\r\n\r\n    return actions\r\n        .map(action => {\r\n            if (typeof action !== 'string') return action\r\n            if (!pack) return undefined\r\n            const entry = pack.index.get(action)\r\n            if (!entry) return undefined\r\n            return { name: entry.name, uuid: `Compendium.${DECK_PACK}.${entry._id}` }\r\n        })\r\n        .filter(x => x) as HeroAction[]\r\n}\r\n\r\nexport async function getHeroActionDetails(uuid: string) {\r\n    const document = await fromUuid(uuid)\r\n    if (!(document instanceof JournalEntry)) return undefined\r\n\r\n    const page = document.pages.contents[0]\r\n\r\n    let text = page.text.content\r\n    if (text && document.pack === DECK_PACK) text = text.replace(/^<p>/, '<p><strong>Trigger</strong> ')\r\n\r\n    return text ? { name: document.name, description: text } : undefined\r\n}\r\n\r\nexport function setHeroActions(actor: CharacterPF2e, actions: HeroAction[]) {\r\n    return setFlag(actor, 'heroActions', actions)\r\n}\r\n\r\nexport function getTableSource(unique = true, table?: RollTable) {\r\n    const source = {\r\n        name: localize('table.name'),\r\n        replacement: !unique,\r\n        img: ICON,\r\n        description: localize('table.description'),\r\n    }\r\n    if (!table) return source\r\n    return mergeObject(duplicate(table._source), source)\r\n}\r\n\r\nexport async function createDefautActionsTable(unique = true) {\r\n    const table = await fromUuid<RollTable>(TABLE_UUID)\r\n    const source = getTableSource(unique, table!)\r\n    return RollTable.create(source, { temporary: false }) as Promise<RollTable>\r\n}\r\n\r\nexport function createCustomActionsTable(unique = true) {\r\n    const source = getTableSource(unique)\r\n    return RollTable.create(source, { temporary: false }) as Promise<RollTable>\r\n}\r\n\r\nexport async function drawHeroAction() {\r\n    const table = await getDeckTable()\r\n\r\n    if (!table) {\r\n        error('table.error', true)\r\n        return undefined\r\n    }\r\n\r\n    if (table.formula) {\r\n        if (game.user.isGM) {\r\n            await table.normalize()\r\n        } else {\r\n            error('table.noFormula', true)\r\n            return null\r\n        }\r\n    }\r\n\r\n    if (table.replacement) {\r\n        const drawn = table.results.filter(r => !(r as TableResult).drawn)\r\n        if (!drawn.length) await table.resetResults()\r\n    }\r\n\r\n    const draw = (await table.draw({ displayChat: false })).results[0]\r\n    const uuid = documentUuidFromTableResult(draw)\r\n\r\n    if (uuid) return { uuid, name: draw.text }\r\n    return undefined\r\n}\r\n","export function documentUuidFromTableResult(result: TableResult) {\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.DOCUMENT) return `${result.documentCollection}.${result.documentId}`\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.COMPENDIUM) return `Compendium.${result.documentCollection}.${result.documentId}`\r\n    return undefined\r\n}\r\n\r\nexport function chatUUID(uuid: string, name?: string) {\r\n    if (name) return `@UUID[${uuid}]{${name}}`\r\n    return `@UUID[${uuid}]`\r\n}\r\n","import { getFlag, setFlag } from './@utils/foundry/flags'\r\nimport { localize } from './@utils/foundry/i18n'\r\nimport { error, warn } from './@utils/foundry/notifications'\r\nimport { flagsUpdatePath, templatePath } from './@utils/foundry/path'\r\nimport { getSetting } from './@utils/foundry/settings'\r\nimport { chatUUID } from './@utils/foundry/uuid'\r\nimport { drawHeroAction, getHeroActionDetails, getHeroActions, setHeroActions } from './actions'\r\nimport { Trade } from './apps/trade'\r\n\r\nexport async function renderCharacterSheetPF2e(sheet: CharacterSheetPF2e, $html: JQuery) {\r\n    const actor = sheet.actor\r\n    if (actor.pack || !actor.id || !game.actors.has(actor.id)) return\r\n    await addHeroActions($html, actor)\r\n    addEvents($html, actor)\r\n}\r\n\r\nasync function addHeroActions(html: JQuery, actor: CharacterPF2e) {\r\n    const actions = getHeroActions(actor)\r\n    const diff = actor.heroPoints.value - actions.length\r\n    const isOwner = actor.isOwner\r\n\r\n    const template = await renderTemplate(templatePath('sheet.html'), {\r\n        owner: isOwner,\r\n        list: actions,\r\n        canUse: diff >= 0 && isOwner,\r\n        canDraw: diff > 0 && isOwner,\r\n        canTrade: getSetting('trade'),\r\n        mustDiscard: diff < 0,\r\n        diff: Math.abs(diff),\r\n    })\r\n\r\n    html.find('.tab[data-tab=\"actions\"] .actions-panel[data-tab=\"encounter\"] > .strikes-list:not(.skill-action-list)')\r\n        .first()\r\n        .after(template)\r\n}\r\n\r\nfunction addEvents(html: JQuery, actor: CharacterPF2e) {\r\n    const $list = html.find('.tab.actions .heroActions-list')\r\n    $list.find('[data-action=draw]').on('click', event => onClickHeroActionsDraw(actor, event))\r\n    $list.find('[data-action=expand]').on('click', onClickHeroActionExpand)\r\n    $list.find('[data-action=use]').on('click', event => onClickHeroActionUse(actor, event))\r\n    $list.find('[data-action=display]').on('click', event => onClickHeroActionDisplay(actor, event))\r\n    $list.find('[data-action=discard]').on('click', onClickHeroActionDiscard)\r\n    $list.find('[data-action=discard-selected]').on('click', () => onClickHeroActionsDiscard(actor, html))\r\n    html.find('[data-action=hero-actions-trade]').on('click', () => onClickHeroActionsTrade(actor))\r\n}\r\n\r\nfunction onClickHeroActionsTrade(actor: CharacterPF2e) {\r\n    const actions = getFlag<Array<any>>(actor, 'heroActions')\r\n    if (!actions || !actions.length) {\r\n        warn('no-action')\r\n        return\r\n    }\r\n\r\n    const diff = actions.length - actor.heroPoints.value\r\n    if (diff > 0) {\r\n        warn('no-points', { nb: diff.toString() })\r\n        return\r\n    }\r\n\r\n    new Trade(actor).render(true)\r\n}\r\n\r\nasync function onClickHeroActionExpand(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n\r\n    const $action = $(event.currentTarget).closest('.action')\r\n    const $summary = $action.find('.item-summary')\r\n\r\n    if (!$summary.hasClass('loaded')) {\r\n        const uuid = $action.attr('data-uuid')!\r\n        const details = await getHeroActionDetails(uuid)\r\n        if (!details) return\r\n\r\n        const text = await TextEditor.enrichHTML(details.description, { async: true })\r\n\r\n        $summary.find('.item-description').html(text)\r\n        $summary.addClass('loaded')\r\n    }\r\n\r\n    $action.toggleClass('expanded')\r\n}\r\n\r\nasync function onClickHeroActionDisplay(actor: CharacterPF2e, event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n\r\n    const uuid = $(event.currentTarget).closest('.action').attr('data-uuid')!\r\n    const details = await getHeroActionDetails(uuid)\r\n    if (!details) return error('details.missing')\r\n\r\n    ChatMessage.create({\r\n        content: `<h2>${details.name}</h2>${details.description}`,\r\n        speaker: ChatMessage.getSpeaker({ actor }),\r\n    })\r\n}\r\n\r\nfunction onClickHeroActionDiscard(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n\r\n    const action = $(event.currentTarget).closest('.action')\r\n    const list = action.closest('.heroActions-list')\r\n\r\n    action.toggleClass('discarded')\r\n\r\n    const toDiscard = Number(list.attr('data-discard') ?? '0')\r\n    const $discarded = list.find('.action.discarded')\r\n\r\n    list.toggleClass('discardable', $discarded.length === toDiscard)\r\n}\r\n\r\nasync function onClickHeroActionsDiscard(actor: CharacterPF2e, html: JQuery) {\r\n    const discarded = html.find('.tab.actions .heroActions-list .action.discarded')\r\n    const uuids = discarded.toArray().map(x => x.dataset.uuid)\r\n    const actions = getHeroActions(actor)\r\n    const removed = /** @type {HeroAction[]} */ []\r\n\r\n    for (const uuid of uuids) {\r\n        const index = actions.findIndex(x => x.uuid === uuid)\r\n        if (index === -1) continue\r\n        removed.push(actions[index])\r\n        actions.splice(index, 1)\r\n    }\r\n\r\n    setHeroActions(actor, actions)\r\n\r\n    const display = removed.map(x => chatUUID(x.uuid, x.name))\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('actions-discard.header', { nb: display.length })}</h4>`,\r\n        content: display.map(x => `<div>${x}</div>`).join(''),\r\n        speaker: ChatMessage.getSpeaker({ actor }),\r\n    })\r\n}\r\n\r\nasync function onClickHeroActionsDraw(actor: CharacterPF2e, event: JQuery.ClickEvent) {\r\n    event.preventDefault()\r\n\r\n    const actions = getHeroActions(actor)\r\n    const nb = actor.heroPoints.value - actions.length\r\n\r\n    const drawn = /** @type {HeroAction[]} */ []\r\n    for (let i = 0; i < nb; i++) {\r\n        const action = await drawHeroAction()\r\n\r\n        if (action === undefined) continue\r\n        else if (action === null) return\r\n\r\n        actions.push(action)\r\n        drawn.push(action)\r\n    }\r\n\r\n    if (!drawn.length) return\r\n\r\n    setHeroActions(actor, actions)\r\n\r\n    const display = drawn.map(x => chatUUID(x.uuid, x.name))\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('actions-draw.header', { nb: display.length })}</h4>`,\r\n        content: display.map(x => `<div>${x}</div>`).join(''),\r\n        speaker: ChatMessage.getSpeaker({ actor }),\r\n    })\r\n}\r\n\r\nasync function onClickHeroActionUse(actor: CharacterPF2e, event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n\r\n    const points = actor.heroPoints.value\r\n    if (points < 1) return warn('use.noPoints')\r\n\r\n    const uuid = $(event.currentTarget).closest('.action').attr('data-uuid')!\r\n    const actions = getHeroActions(actor)\r\n\r\n    const index = actions.findIndex(x => x.uuid === uuid)\r\n    if (index === -1) return\r\n\r\n    const details = await getHeroActionDetails(uuid)\r\n    if (!details) error('use.noDetails')\r\n\r\n    actions.splice(index, 1)\r\n\r\n    if (details) {\r\n        actor.update({\r\n            ['system.resources.heroPoints.value']: points - 1,\r\n            [flagsUpdatePath('heroActions')]: actions,\r\n        })\r\n\r\n        ChatMessage.create({\r\n            flavor: `<h4 class=\"action\">${localize('actions-use.header')}</h4>`,\r\n            content: `<h2>${details.name}</h2>${details.description}`,\r\n            speaker: ChatMessage.getSpeaker({ actor }),\r\n        })\r\n    } else setFlag(actor, 'heroActions', actions)\r\n}\r\n\r\nexport function refreshSheets() {\r\n    Object.values(ui.windows).forEach(x => {\r\n        if (x instanceof ActorSheet && x.actor.type === 'character') {\r\n            x.render(true)\r\n        }\r\n    })\r\n}\r\n","import { getCharacterOwner } from '~src/@utils/foundry/actor'\r\nimport { localize } from '~src/@utils/foundry/i18n'\r\nimport { error, warn } from '~src/@utils/foundry/notifications'\r\nimport { templatePath } from '~src/@utils/foundry/path'\r\nimport { getGM, getOwner } from '~src/@utils/foundry/user'\r\nimport { getHeroActions } from '~src/actions'\r\nimport { sendTradeRequest } from '~src/trade'\r\n\r\nexport class Trade extends Application {\r\n    private _actor: CharacterPF2e\r\n    private _target?: CharacterPF2e\r\n\r\n    constructor(actor: CharacterPF2e) {\r\n        super({ id: `pf2e-hero-actions-trade-${actor.id}` })\r\n        this._actor = actor\r\n    }\r\n\r\n    static get defaultOptions(): ApplicationOptions {\r\n        return mergeObject(super.defaultOptions, {\r\n            title: localize('templates.trade.title'),\r\n            template: templatePath('trade.html'),\r\n            width: 600,\r\n            height: 'auto',\r\n        })\r\n    }\r\n\r\n    get actor() {\r\n        return this._actor\r\n    }\r\n\r\n    get target() {\r\n        return this._target\r\n    }\r\n\r\n    set target(value) {\r\n        if (!value) {\r\n            error('templates.trade.no-target')\r\n            return\r\n        }\r\n        if (value === this._target) return\r\n        delete this.target?.apps?.[this.appId]\r\n        this._target = value\r\n        this.render()\r\n    }\r\n\r\n    getData(options?: Partial<ApplicationOptions> | undefined): object | Promise<object> {\r\n        return mergeObject(super.getData(), {\r\n            actor: this.actor,\r\n            target: this.target,\r\n            targets: game.actors.filter(x => x.type === 'character' && x.id !== this.actor.id && x.hasPlayerOwner),\r\n            actions: getHeroActions(this.actor),\r\n            targetActions: this.target ? getHeroActions(this.target) : [],\r\n        })\r\n    }\r\n\r\n    activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html)\r\n        html.find('select[name=\"target\"]').on('change', this.#onChangeTarget.bind(this))\r\n        html.find('[data-action=\"description\"]').on('click', this.#onDescription.bind(this))\r\n        html.find('[data-action=\"trade\"]').on('click', this.#onSendTrade.bind(this))\r\n        html.find('[data-action=\"cancel\"]').on('click', () => this.close())\r\n    }\r\n\r\n    render(force?: boolean | undefined, options?: RenderOptions | undefined): this | Promise<this> {\r\n        this.actor.apps[this.appId] = this\r\n        if (this.target) this.target.apps[this.appId] = this\r\n        return super.render(force, options)\r\n    }\r\n\r\n    async close(options?: ({ force?: boolean | undefined } & Record<string, unknown>) | undefined): Promise<void> {\r\n        await super.close(options)\r\n        delete this.actor.apps?.[this.appId]\r\n        delete this.target?.apps?.[this.appId]\r\n    }\r\n\r\n    #onSendTrade() {\r\n        if (!this.target) {\r\n            warn('templates.trade.no-target')\r\n            return\r\n        }\r\n\r\n        const action = this.element.find('[name=\"action\"]:checked').val()\r\n        const target = this.element.find('[name=\"targetAction\"]:checked').val()\r\n\r\n        if (typeof action !== 'string' || typeof target !== 'string') {\r\n            warn('templates.trade.no-select')\r\n            return\r\n        }\r\n\r\n        let user = getCharacterOwner(this.target, true) ?? getOwner(this.target, true) ?? getGM(true)\r\n        if (!user) {\r\n            warn('templates.trade.no-user')\r\n            return\r\n        }\r\n\r\n        sendTradeRequest({\r\n            sender: {\r\n                id: game.user.id,\r\n                cid: this.actor.id,\r\n                uuid: action,\r\n            },\r\n            receiver: {\r\n                id: user.id,\r\n                cid: this.target.id,\r\n                uuid: target,\r\n            },\r\n        })\r\n\r\n        this.close()\r\n    }\r\n\r\n    async #onDescription(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n        const uuid = $(event.currentTarget).siblings('input').val() as string\r\n        const entry = await fromUuid<JournalEntry>(uuid)\r\n        entry?.sheet.render(true)\r\n    }\r\n\r\n    #onChangeTarget(event: JQuery.ChangeEvent<any, any, HTMLElement>) {\r\n        const id = (event.currentTarget as HTMLSelectElement).value\r\n        this.target = game.actors.get<CharacterPF2e>(id)\r\n    }\r\n}\r\n","export function getActorTokens(actor: Actor, linkedOnly = false) {\r\n    return game.scenes\r\n        .map(scene =>\r\n            scene.tokens.filter(\r\n                token =>\r\n                    (token as Embedded<TokenDocument> & { actorId: string }).actorId === actor.id &&\r\n                    (!linkedOnly || token.actorLink)\r\n            )\r\n        )\r\n        .flat()\r\n}\r\n\r\nexport function getCharacterOwner(actor: Actor, connected = false) {\r\n    if (connected) return game.users.find(x => x.active && x.character === actor)\r\n    return game.users.find(x => x.character === actor)\r\n}\r\n","export function isGM() {\r\n    const data = game.data as Game['data'] & { userId: string }\r\n    const user = data.users.find(x => x._id === data.userId)\r\n    return !!user && user.role >= CONST.USER_ROLES.GAMEMASTER\r\n}\r\n\r\nexport function getOwners(doc: foundry.abstract.Document, connected = false) {\r\n    if (connected) return game.users.filter(x => x.active && doc.testUserPermission(x, 'OWNER'))\r\n    return game.users.filter(x => doc.testUserPermission(x, 'OWNER'))\r\n}\r\n\r\nexport function getOwner(doc: foundry.abstract.Document, connected = false) {\r\n    if (connected) return game.users.find(x => x.active && doc.testUserPermission(x, 'OWNER'))\r\n    return game.users.find(x => doc.testUserPermission(x, 'OWNER'))\r\n}\r\n\r\nexport function getGM(connected = false) {\r\n    if (connected) return game.users.find(x => x.active && x.isGM)\r\n    return game.users.find(x => x.isGM)\r\n}\r\n","import { getFlag, setFlag } from './@utils/foundry/flags'\r\nimport { localize } from './@utils/foundry/i18n'\r\nimport { warn, error } from './@utils/foundry/notifications'\r\nimport { chatUUID } from './@utils/foundry/uuid'\r\nimport { socketEmit } from './@utils/socket'\r\n\r\nexport async function onTradeRequest(trade: BaseTrade) {\r\n    const { sender, receiver } = trade\r\n    const senderActor = game.actors.get(sender.cid)\r\n    const receiverActor = game.actors.get(receiver.cid)\r\n\r\n    if (!senderActor || !receiverActor) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    let content = `<p>${localize('trade-request.header', { sender: senderActor.name, receiver: receiverActor.name })}</p>`\r\n    content += `<p>${localize('trade-request.give', { give: chatUUID(sender.uuid) })}</p>`\r\n    content += `<p>${localize('trade-request.want', { want: chatUUID(receiver.uuid) })}</p>`\r\n    content += `<p style=\"margin-bottom: 1em;\">${localize('trade-request.accept')}</p>`\r\n\r\n    const accept = await Dialog.confirm({\r\n        title: localize('trade-request.title'),\r\n        content: await TextEditor.enrichHTML(content, { async: true }),\r\n    })\r\n\r\n    if (accept) acceptRequest(trade)\r\n    else rejectRequest(trade)\r\n}\r\n\r\nexport async function onTradeAccepted(trade: BaseTrade) {\r\n    const { sender, receiver } = trade\r\n    const senderActor = game.actors.get(sender.cid)\r\n    const receiverActor = game.actors.get(receiver.cid)\r\n\r\n    if (!senderActor || !receiverActor) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    const senderActions = getFlag<HeroAction[]>(senderActor, 'heroActions') ?? []\r\n    const receiverActions = getFlag<HeroAction[]>(receiverActor, 'heroActions') ?? []\r\n\r\n    const senderActionIndex = senderActions.findIndex(x => x.uuid === sender.uuid)\r\n    const receiverActionIndex = receiverActions.findIndex(x => x.uuid === receiver.uuid)\r\n\r\n    if (senderActionIndex === -1 || receiverActionIndex === -1) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    const senderAction = senderActions.splice(senderActionIndex, 1)[0]\r\n    const receiverAction = receiverActions.splice(receiverActionIndex, 1)[0]\r\n\r\n    senderActions.push(receiverAction)\r\n    receiverActions.push(senderAction)\r\n\r\n    setFlag(senderActor, 'heroActions', senderActions)\r\n    setFlag(receiverActor, 'heroActions', receiverActions)\r\n\r\n    let content = `<div>${localize('trade-success.offer', { offer: chatUUID(senderAction.uuid) })}</div>`\r\n    content += `<div>${localize('trade-success.receive', { receive: chatUUID(receiverAction.uuid) })}</div>`\r\n\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('trade-success.header', { name: receiverActor.name })}</h4>`,\r\n        content,\r\n        speaker: ChatMessage.getSpeaker({ actor: senderActor }),\r\n    })\r\n}\r\n\r\nexport async function onTradeRejected({ receiver }: BaseTrade) {\r\n    const actor = game.actors.get(receiver.cid)!\r\n    warn('trade-rejected', { name: actor.name }, true)\r\n}\r\n\r\nexport function onTradeError(err: string) {\r\n    error('trade-error')\r\n}\r\n\r\nexport function sendTradeRequest(trade: BaseTrade) {\r\n    if (trade.receiver.id === game.user.id) {\r\n        acceptRequest(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit<TradeRequestPacket>({\r\n        ...trade,\r\n        type: 'trade-request',\r\n    })\r\n}\r\n\r\nfunction rejectRequest(trade: BaseTrade) {\r\n    if (trade.sender.id === game.user.id) {\r\n        onTradeRejected(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit<TradeRejectPacket>({\r\n        ...trade,\r\n        type: 'trade-reject',\r\n    })\r\n}\r\n\r\nfunction acceptRequest(trade: BaseTrade) {\r\n    if (game.user.isGM) {\r\n        onTradeAccepted(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit<TradeAcceptPacket>({\r\n        ...trade,\r\n        type: 'trade-accept',\r\n    })\r\n}\r\n\r\nfunction sendTradeError({ sender, receiver }: BaseTrade, error: TradeError = 'trade-error') {\r\n    const users = new Set([sender.id, receiver.id])\r\n\r\n    if (users.has(game.user.id)) {\r\n        users.delete(game.user.id)\r\n        onTradeError(error)\r\n    }\r\n\r\n    if (!users.size) return\r\n\r\n    socketEmit<TradeErrorPacket>({\r\n        type: 'trade-error',\r\n        users: Array.from(users),\r\n        error,\r\n    })\r\n}\r\n"],"names":[],"version":3,"file":"main.js.map"}